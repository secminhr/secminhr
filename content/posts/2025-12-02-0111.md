---
title: "Validity of Binary Search in Leetcode 2141"
date: 2025-12-02T01:11:37+0800
categories: ["Article"]
tags: ["leetcode", "Featured"]
---

From the editorial:
> We can freely use every battery except the largest 4 to increase the total running time. Because we can freely swap batteries in 0 time, all the extra power is interchangeable. We can take this extra power and "transfer" it to the batteries in live. Let extra be the sum of all the extra power.

It seems to me that it claims that the number of batteries in the "extra" part doesn't matter, but how could 7 batteries with power 1 the same as 1 batteries with power 7?

I couldn't see it.


---
After some of discussions with colleagues, I got some idea of formalism.

# Notations
We use $n$ as number of computers and $m$ as numbers of batteries.
Some additional notations:
- $battery_t^i$: the power left in the i-th largest battery at time $t$.
    - $battery_t = [battery_t^1, battery_t^2, ..., battery_t^m]$
    - For $1 \le i \le j \le m$, $battery_t[i, j] = [battery_i, battery_{i+1}, ..., battery_j]$ 
    - For $i > j$, $battery_t[i, j] = []$
- $L^x_t$: the number of batteries with $x$ power left at time $t$. In essence, $L_t^x = length(filter\ (=x)\ battery_t)$
    - For $1 \le i \le j \le m$, $L_t^x[i, j] =  length(filter\ (=x)\ battery_t[i, j])$
    - Note that for $1 \le k \le m$, we have $L_t^x = L_t^x[1, k] + L_t^x[k+1, m]$

Therefore, the following represents that time $t$ is reachable.
$$
\begin{equation}
m - L_{t-1}^0 \ge n \tag{reachability}
\end{equation}
$$

# Optimal strategy
In order to lasts as long as possible, we always choose the largest $n$ batteries to insert to each computer, so the $n$ largest batteries will have 1 power reduced.

This strategy requires that if $t$ is reachable, then $L_{t-1}^0[1, n] = 0$, and that $L_t^x$ has the following relation
$$
\begin{equation}
L_t^x = L_{t-1}^{x+1}[1, n] + L_{t-1}^x[n+1, m] \tag{L-rec}
\end{equation}
$$
(A battery with $x$ power left at $t$ is either a battery within $n$ largest and has $x+1$ power at $t-1$, or a battery outside of the $n$ largest and has $x$ power at $t-1$)

At the same time, the sum of power of batteries should be reduced by $n$.
$$
\begin{equation}
\sum_{i=1}^m battery_{t-1}^i = n + \sum_{i=1}^m battery_t^i \tag{B-rec}
\end{equation}
$$

Note specifically that $\sum_{i=1}^m battery_{t-1}^i = \sum_{i=1}^{m-L_0^0} battery_{t-1}^i$

# Prove of validity of binary search
For the binary search approach in editoral to work, we must prove that
$$
\sum_{i=1}^m min(t_1, battery_0^i) \ge nt_1 \iff \forall 0 \le t < t_1. m-L_t^0\ge n
$$

Proving the following will be sufficient, since our original goal is an immediate result of it, 
as $\forall b \in [min(t_1, battery_0^i)\ |\ 1 \le i \le m]$ we have $b \le t_1$.
$$
\text{if } \forall b \in battery_0^i.\ b \le t_1 \text{then} \\
\sum_{i=1}^m battery_0^i \ge nt_1 \iff \forall 0 \le t < t_1. m-L_t^0\ge n
$$

## $\implies$
We have assumptions $\forall b \in battery_0^i \le t_1$ and $\sum_{i=1}^m battery_0^i \ge nt_1$ 
We prove by induction on $t$ from $0$ to $t_1 - 1$.
### Base: $t = 0$
$$
nt_1 \le \sum_{i=1}^m battery_0^i = \sum_{i=1}^{m-L_0^0} battery_0^i \le \sum_{i=1}^{m-L_0^0}t_1 = (m-L_0^0)t_1
$$
Thus $n \le m-L_0^0$
### Induction
Now we additionally have the assumption $m-L_{t-1}^0 \ge n$, and want to have $m-L_t^0 \ge n$.
By definition of reachability and the induction assumption, $t$ is reachable.
$$
\begin{aligned}
m-L_t^0 &= m-(L_{t-1}^1[1, n] + L_{t-1}^0[n+1, m])\ \ \ \ \ \ \text{(L-rec)}\\
&=m-(L_{t-1}^1[1, n] + L_{t-1}^0 - L_{t-1}^0[1, n])\\
&=m-L_{t-1}^0+(L_{t-1}^0[1, n] - L_{t-1}^1[1, n]) \\
&=m-L_{t-1}^0-(L_{t-1}^1[1, n] - L_{t-1}^0[1, n]) \\
&\ge n-(L_{t-1}^1[1, n] - L_{t-1}^0[1, n])\\
&=n-L_{t-1}^1[1, n]
\end{aligned}
$$

$L_{t-1}^1[1, n] \ge 0$ is a must since it's a length, thus $m-L_t^0 \ge n-L_{t-1}^1[1, n] \ge n$

## $\impliedby$
We have assumptions $\forall b \in battery_0^i \le t_1$ and $\forall 0 \le t < t_1. m-L_t^0 \ge n$

By definition, $t+1$ is reachable (thus ranging from $1$ to $t_1$). We can apply $\text{B-rec}$ to calculate.

$$
\begin{aligned}
\sum_{i=1}^m battery_0^i &= n + \sum_{i=1}^m battery_1^i \\
&=2n+\sum_{i=1}^m battery_2^i\\
&= 3n + ...\\
&= t_1n+\sum_{i=1}^m battery_{t_1}^i \ge nt_1
\end{aligned}
$$

Both direction is thus proved.