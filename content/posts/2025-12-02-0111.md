---
title: "Q: Leetcode 2141"
date: 2025-12-02T01:11:37+0800
categories: ["Draft"]
tags: ["leetcode", "Unsolved"]
---

From the editorial:
> We can freely use every battery except the largest 4 to increase the total running time. Because we can freely swap batteries in 0 time, all the extra power is interchangeable. We can take this extra power and "transfer" it to the batteries in live. Let extra be the sum of all the extra power.

It seems to me that it claims that the number of batteries in the "extra" part doesn't matter, but how could 7 batteries with power 1 the same as 1 batteries with power 7?

I couldn't see it.


---
After some of discussions with colleagues, I got some idea of formalism.

First define some symbols:
- $n$: the number of computers
- $m$: the total number of batteries

The optimal strategy of choosing batteries is "at any time, always choose the n batteries with most power left". And base on that, we further define:

- $battery_t^i$: the leftover time for the $i$'th largest battery at time $t$. $t$ starts from 0 and $i$ starts from 1.
    - We define an assistant $battery_t = [battery_t^1, battery_t^2, ..., battery_t^m]$
    - By definition, we have $battery_t^i \ge battery_t^{i+1}$
    - And the indexing of $battery_t$
        - For $1 \le i \le j \le m$, $battery_t[i, j] = [battery_t^i, battery_t^{i+1}, ..., battery_t^j]$ 
        - For $i > j$, $battery_t[i, j] = []$
- $m_t$: the number of batteries whose still has energy at time $t$.
    - This is just shorthand for $length ( filter (> 0)\ battery_t)$
    - Additional assistant: 
        - $L_{xt} = length(filter\ (=x)\ battery_t)$
        - $L_{xt}[i, j] = length(filter\ (=x)\ battery_t[i, j])$
    - $\forall t.m_t \ge m_{t+1}$ should be obvious
    - By our optimal strategy, as long as $m_t >= n$, then $m_t = m_{t+1} + L_{1t}[1, n]$
    - For $L_{1t}[1, n] > 0$ to be true, we must have 
    - Therefore
    $$\begin{aligned}
    m_0 &= m_1 + length(filter\ (=1)\ battery_0[1, n]) \\
    &= m_2 + length(filter\ (=1)\ battery_1[1, n]) + length(filter\ (=1)\ battery_0[1, n]) \\
    &= m_t + \sum_{i = 0}^{t-1} length(filter\ (=1)\ battery_i[1, n]) \text{ where } m_t < n, m_{t-1} \ge n
    \end{aligned}$$

We found that "the system ends at time $t$" can be represented as $m_t < n$

To utilize the editorial's binary search solution, we must prove that for the target time $t > 0$:
$$
\sum_{i=1}^m min(battery_0^i, t) \ge nt \implies\\ \nexists t'<t \text{ s.t. } m_{t'} < n
$$

We first prove the case where $\forall b \in battery_0.\ b \le t$.
Therefore the proposition can be sipmlified to
$$
\sum_{i=1}^m battery_0^i \ge nt \implies\\ \nexists t'<t \text{ s.t. } m_{t'} < n
$$

### $m_0 \ge n$
$nt \le \sum_{i=1}^m battery_0^i = \sum_{i=1}^{m_0} battery_0^i$
$n \le \sum_{i=1}^{m_0}\frac{battery_0^i}t \le \sum_{i=1}^{m_0}1 = m_0$

### Given $m_{t'} \ge n$, $t'+1 < t$, then $m_{t'+1} \ge n$
Assume $m_{t'+1} < n$

$length(filter\ (=1)\ battery_{t'}[1, n]) \le m_{t'}$

$m_{t'} = m_{t'+1} + length(filter\ (=1)\ battery_{t'}[1, n]) < n+ length(filter\ (=1)\ battery_{t'}[1, n])$
$0 \le m_{t'} - n < length(filter\ (=1)\ battery_{t'}[1, n])$

$m_{t'+1} < n \le m_{t'}$
$0 < n-m_{t'+1} \le m_{t'} - m_{t'+1} = length(filter\ (=1)\ battery_{t'}[1, n])$

Note that $length(filter\ (=1)\ battery_{t'}[1, n]) = \sum battery_t[n-(length...)+1, n]$

$\sum_{i=1}^m battery_{t'}^i = \sum_{i=1}^{m_{t'}} battery_{t'}^i = \sum_{i=1}^{n-length...} battery_{t'}^i + $
## Utilities
- $$
\forall t' < t. \sum_{i=1}^m battery_{t'}^i= n + \sum_{i=1}^m battery_{t'+1}^i
$$
- $$
\forall t'.\sum_{i=1}^m battery_{t'}^i = \sum_{i=1}^{m_{t'}} battery_{t'}^i
$$
- $$
\forall t'.\sum_{i=1}^m min(battery_{t'}^i, t)\le \sum_{i=1}^m battery_{t'}^i
$$
- $$
\forall t'.\sum_{i=1}^m min(battery_{t'}^i, t)\le \sum_{i=1}^m t = \sum_{i=1}^{m_{t'}} t= m_{t'}t
$$